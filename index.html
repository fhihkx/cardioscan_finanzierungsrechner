<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>cardioscan Finance Calculator</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- html2pdf Library for PDF Generation -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    
    <!-- Fonts: Montserrat (Headings) & Open Sans (Body) -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@300;400;500;600;700;800&family=Open+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        cs: {
                            blue: '#2c62f2',      // Primary Blue
                            blueHover: '#1a4bd6',
                            navy: '#0b1c33',      // Dark Navy Background
                            text: '#0b1c33',      // Main Text Color
                            light: '#F8F9FB',     // Page Background
                            border: '#E6E9F0'
                        }
                    },
                    fontFamily: {
                        sans: ['Montserrat', 'sans-serif'],
                        body: ['Open Sans', 'sans-serif']
                    },
                    boxShadow: {
                        'card': '0 20px 60px -15px rgba(11, 28, 51, 0.12)',
                        'glow': '0 0 40px rgba(44, 98, 242, 0.3)',
                        'inner-light': 'inset 0 1px 0 rgba(255,255,255,0.1)'
                    },
                    borderRadius: {
                        '3xl': '24px',
                        '4xl': '32px'
                    },
                    transitionProperty: {
                        'height': 'height, max-height'
                    }
                }
            }
        }
    </script>

    <style>
        body { font-family: 'Open Sans', sans-serif; background-color: #F8F9FB; color: #0b1c33; overflow-x: hidden; }
        h1, h2, h3, h4, .font-heading { font-family: 'Montserrat', sans-serif; }

        /* Navigation Style */
        .nav-item {
            font-weight: 700;
            font-size: 14px;
            color: #0b1c33;
            letter-spacing: 0.02em; 
            transition: color 0.2s;
        }
        .nav-item:hover { color: #2c62f2; }

        /* Tab Buttons */
        .tab-nav {
            background: #fff;
            padding: 9px; 
            border-radius: 14px;
            box-shadow: 0 4px 25px rgba(0,0,0,0.05);
            display: inline-flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 7px; 
        }
        .tab-btn {
            padding: 20px 56px; 
            border-radius: 8px;
            font-family: 'Montserrat', sans-serif;
            font-weight: 700;
            font-size: 18px; 
            color: #64748b;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            white-space: nowrap;
        }
        .tab-btn.active {
            background: #2c62f2;
            color: #fff;
            box-shadow: 0 4px 15px rgba(44, 98, 242, 0.3);
            transform: scale(1.02);
        }
        .tab-btn:hover:not(.active) {
            color: #2c62f2;
            background: #F0F5FF;
        }

        /* Calculator Specifics */
        .calc-input-wrapper {
            background: #F8F9FB;
            border: 2px solid #E6E9F0;
            border-radius: 8px;
            padding: 12px 20px;
            transition: all 0.2s;
            display: flex;
            align-items: center;
        }
        .calc-input-wrapper:focus-within {
            border-color: #2c62f2;
            background: #fff;
            box-shadow: 0 0 0 4px rgba(44, 98, 242, 0.1);
            transform: translateY(-2px);
        }
        .calc-input {
            width: 100%;
            background: transparent;
            border: none;
            outline: none;
            font-family: 'Montserrat', sans-serif;
            font-weight: 600;
            color: #0b1c33;
            font-size: 20px;
            padding: 4px 0;
        }
        
        /* HIDE INPUT SPINNERS (Arrows) */
        input[type=number]::-webkit-outer-spin-button,
        input[type=number]::-webkit-inner-spin-button {
          -webkit-appearance: none;
          margin: 0;
        }
        input[type=number] {
          -moz-appearance: textfield;
        }

        .calc-label {
            font-size: 12px;
            font-weight: 700;
            color: #64748b;
            margin-bottom: 8px;
            display: block;
        }

        /* Form Inputs (Step 2) */
        .form-input {
            width: 100%;
            background-color: #F8F9FB;
            border: 2px solid #E6E9F0;
            border-radius: 8px;
            padding: 12px 16px;
            font-weight: 600;
            color: #0b1c33;
            outline: none;
            transition: all 0.2s;
        }
        .form-input:focus {
            border-color: #2c62f2;
            background-color: #fff;
        }

        /* Container Height Transition */
        #content-container {
            transition: height 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* Helper for Step Transitions within Calculator */
        .step-transition {
            transition: opacity 0.3s ease-in-out, transform 0.3s ease-in-out;
        }
        .hidden-step {
            display: none;
            opacity: 0;
            pointer-events: none;
        }
        .active-step {
            display: flex;
            opacity: 1;
            pointer-events: auto;
        }

        /* Mobile Adjustments */
        @media (max-width: 640px) {
            .tab-btn { padding: 16px 32px; font-size: 14px; width: 100%; }
            .tab-nav { border-radius: 12px; width: 100%; }
        }
    </style>
</head>
<body class="flex flex-col min-h-screen">

    <!-- HEADER -->
    <header class="bg-white/90 backdrop-blur-md sticky top-0 z-50 border-b border-gray-100 transition-all duration-300">
        <div class="max-w-[1400px] mx-auto px-6 md:px-8 py-4 flex items-center justify-between">
            <!-- Logo -->
            <a href="https://cardioscan.de" target="_blank" class="flex items-center group shrink-0">
                <img src="cardioscan_logo.png" alt="cardioscan Logo" class="h-8 md:h-12 object-contain group-hover:opacity-80 transition-opacity">
            </a>

            <!-- Actions -->
            <div class="flex items-center gap-6">
                <a href="https://cardioscan.de/vertrieb-kontaktieren" target="_blank" class="bg-cs-blue text-white px-6 py-3 rounded-md text-sm font-bold uppercase tracking-wide hover:bg-blue-600 transition-colors shadow-md whitespace-nowrap">
                    VERTRIEB KONTAKTIEREN
                </a>
            </div>
        </div>
    </header>

    <!-- HERO -->
    <section class="pt-16 pb-12 px-6 text-center">
        <h1 class="text-4xl md:text-6xl font-extrabold text-cs-navy mb-6 tracking-tight">
            Smart Finance
        </h1>
        <p class="text-lg text-slate-500 max-w-2xl mx-auto">
            Investieren Sie in die Zukunft Ihrer Kunden. <br class="hidden md:block">
            Flexibel, transparent und ohne Kapitalbindung.
        </p>
    </section>

    <!-- MAIN APP AREA -->
    <main class="w-full max-w-6xl mx-auto px-4 md:px-6 pb-24 relative z-10">
        
        <!-- Tab Navigation -->
        <div class="flex justify-center mb-12">
            <div class="tab-nav">
                <button onclick="switchTab('calculator')" id="tab-calculator" class="tab-btn active">Rechner</button>
                <button onclick="switchTab('why')" id="tab-why" class="tab-btn">Ihre Vorteile</button>
            </div>
        </div>

        <!-- CONTENT CONTAINER (Dynamic Height) -->
        <div id="content-container" class="relative w-full overflow-visible">
            
            <!-- VIEW 1: CALCULATOR (Wraps Step 1 & Step 2) -->
            <div id="view-calculator" class="view-content absolute inset-x-0 top-0 w-full opacity-100 transition-all duration-500 z-10">
                <div class="bg-white rounded-xl shadow-card overflow-hidden border border-gray-100 lg:h-auto relative">
                    
                    <!-- STEP 1: CALCULATION -->
                    <div id="calc-step-1" class="flex flex-col lg:flex-row h-full active-step w-full transition-opacity duration-300">
                        
                        <!-- LEFT: Configuration (White) -->
                        <div class="w-full lg:w-7/12 p-8 md:p-10 lg:p-12 flex flex-col justify-center">
                            <div class="flex items-center justify-between mb-8">
                                <h2 class="text-3xl md:text-4xl font-extrabold text-cs-navy font-heading">Finanzierungsrechner</h2>
                            </div>

                            <div class="space-y-8 w-full">
                                <!-- Price -->
                                <div>
                                    <label class="calc-label">Anschaffungspreis (Netto)</label>
                                    <div class="calc-input-wrapper">
                                        <span class="text-gray-400 font-bold mr-4 text-xl">€</span>
                                        <!-- inputmode="decimal" ist ideal für iOS/Android Touch-Tastaturen -->
                                        <input type="text" id="price" class="calc-input" placeholder="0,00" inputmode="decimal" oninput="formatPriceInput(this)">
                                    </div>
                                </div>

                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-6">
                                    <!-- Duration -->
                                    <div>
                                        <label class="calc-label">Laufzeit</label>
                                        <div class="calc-input-wrapper relative">
                                            <select id="duration" class="calc-input appearance-none cursor-pointer bg-transparent w-full pr-8" onchange="updateResidualOptions()">
                                                <option value="" disabled selected>Bitte wählen</option>
                                                <option value="48">48 Monate</option>
                                                <option value="54">54 Monate</option>
                                                <option value="60">60 Monate</option>
                                            </select>
                                            <div class="absolute right-5 text-cs-blue pointer-events-none">
                                                <i class="fa-solid fa-chevron-down text-sm"></i>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Residual -->
                                    <div>
                                        <label class="calc-label">Restwert</label>
                                        <div class="calc-input-wrapper relative">
                                            <select id="residual" class="calc-input appearance-none cursor-pointer bg-transparent w-full pr-8">
                                                <option value="" disabled selected>Bitte wählen</option>
                                                <option value="5">5 %</option>
                                                <option value="10">10 %</option>
                                                <option value="15">15 %</option>
                                            </select>
                                            <div class="absolute right-5 text-cs-blue pointer-events-none">
                                                <i class="fa-solid fa-chevron-down text-sm"></i>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Action Button -->
                                <div class="pt-2">
                                    <button onclick="calculate()" class="w-full bg-cs-navy text-white font-bold py-5 rounded-lg text-sm hover:bg-cs-blue transition-all shadow-xl hover:shadow-glow hover:-translate-y-1 flex justify-center items-center gap-3 group">
                                        Rate berechnen 
                                        <i class="fa-solid fa-calculator group-hover:rotate-12 transition-transform"></i>
                                    </button>
                                </div>

                                <!-- Error Box -->
                                <div id="error-msg" class="hidden p-4 rounded-lg bg-red-50 border border-red-100 flex items-start md:items-center gap-4 text-red-600 text-sm font-medium animate-pulse">
                                    <i class="fa-solid fa-circle-exclamation text-xl mt-0.5 md:mt-0"></i>
                                    <span id="error-text">Diese Kombination ist aktuell nicht verfügbar.</span>
                                </div>
                            </div>
                        </div>

                        <!-- RIGHT: Result Step 1 (Dark Navy) -->
                        <div class="w-full lg:w-5/12 bg-cs-navy p-8 md:p-10 lg:p-12 text-white flex flex-col relative overflow-hidden">
                            <!-- Abstract Background -->
                            <div class="absolute top-0 right-0 w-96 h-96 bg-cs-blue opacity-10 rounded-full blur-[80px] transform translate-x-1/2 -translate-y-1/2"></div>
                            <div class="absolute bottom-0 left-0 w-64 h-64 bg-blue-400 opacity-5 rounded-full blur-[60px]"></div>
                            
                            <div class="relative z-10 flex flex-col h-full justify-center">
                                <!-- Main Content -->
                                <div class="mb-4">
                                    <div class="inline-block px-4 py-1.5 rounded-md border border-white/20 bg-white/5 text-[10px] font-bold uppercase tracking-widest mb-10 backdrop-blur-sm">
                                        Unverbindliches Angebot
                                    </div>

                                    <div class="text-white/60 font-heading text-sm mb-2 font-bold">Monatliche Rate</div>
                                    <div class="text-6xl md:text-7xl font-extrabold tracking-tighter mb-4 break-words" id="result-display">0,00 €</div>
                                    
                                    <!-- Disclaimer Text -->
                                    <div class="text-[11px] text-white/30 leading-relaxed max-w-sm mt-28">
                                        *Alle Preise zzgl. gesetzlicher MwSt. vorbehaltlich positiver Bonitätsprüfung durch unsere Finanzierungspartner.
                                    </div>
                                </div>

                                <!-- NEXT Button (Bottom Right) -->
                                <div class="mt-auto self-end pt-8">
                                    <button onclick="goToStep(2)" id="btn-next" class="w-14 h-14 bg-white text-cs-navy rounded-full flex items-center justify-center text-xl hover:bg-cs-blue hover:text-white transition-all shadow-lg hover:scale-110 disabled:opacity-50 disabled:cursor-not-allowed disabled:hover:scale-100 disabled:hover:bg-white disabled:hover:text-cs-navy" disabled>
                                        <i class="fa-solid fa-arrow-right"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- STEP 2: CONTACT FORM -->
                    <div id="calc-step-2" class="hidden-step flex-col lg:flex-row h-full w-full transition-opacity duration-300">
                        
                        <!-- LEFT: Form (White) -->
                        <div class="w-full lg:w-7/12 p-8 md:p-10 lg:p-12 flex flex-col justify-center">
                            <div class="flex items-center justify-between mb-6">
                                <h2 class="text-3xl font-extrabold text-cs-navy font-heading">Kontaktdaten</h2>
                            </div>
                            <p class="text-slate-500 mb-8 text-sm">Bitte geben Sie Ihre Daten ein, um das unverbindliche Angebot als PDF zu erhalten.</p>

                            <form class="space-y-4 w-full" onsubmit="event.preventDefault(); downloadOfferPDF();">
                                
                                <!-- Finanzierungsart -->
                                <div>
                                    <label class="calc-label">Finanzierungsart</label>
                                    <div class="relative">
                                        <select id="form-finanzierungsart" class="form-input appearance-none cursor-pointer pr-8" required>
                                            <option value="" disabled selected>Wählen</option>
                                            <option value="Leasing">Leasing</option>
                                            <option value="Mietkauf">Mietkauf</option>
                                        </select>
                                        <div class="absolute right-4 top-1/2 -translate-y-1/2 text-cs-blue pointer-events-none">
                                            <i class="fa-solid fa-chevron-down text-sm"></i>
                                        </div>
                                    </div>
                                </div>

                                <!-- Anrede -->
                                <div>
                                    <label class="calc-label">Anrede</label>
                                    <div class="relative">
                                        <select id="form-anrede" class="form-input appearance-none cursor-pointer pr-8" required>
                                            <option value="" disabled selected>Wählen</option>
                                            <option value="Frau">Frau</option>
                                            <option value="Herr">Herr</option>
                                        </select>
                                        <div class="absolute right-4 top-1/2 -translate-y-1/2 text-cs-blue pointer-events-none">
                                            <i class="fa-solid fa-chevron-down text-sm"></i>
                                        </div>
                                    </div>
                                </div>

                                <!-- Vorname & Nachname -->
                                <div class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                    <div>
                                        <label class="calc-label">Vorname</label>
                                        <input type="text" id="form-vorname" class="form-input" required>
                                    </div>
                                    <div>
                                        <label class="calc-label">Nachname</label>
                                        <input type="text" id="form-nachname" class="form-input" required>
                                    </div>
                                </div>

                                <!-- Firmenname -->
                                <div>
                                    <label class="calc-label">Firmenname</label>
                                    <input type="text" id="form-firma" class="form-input" required>
                                </div>

                                <!-- Adresse -->
                                <div>
                                    <label class="calc-label">Adresse & Hausnummer</label>
                                    <input type="text" id="form-strasse" class="form-input" required>
                                </div>

                                <!-- PLZ & Ort -->
                                <div class="grid grid-cols-3 gap-4">
                                    <div class="col-span-1">
                                        <label class="calc-label">Postleitzahl</label>
                                        <input type="text" id="form-plz" class="form-input" required>
                                    </div>
                                    <div class="col-span-2">
                                        <label class="calc-label">Ort</label>
                                        <input type="text" id="form-ort" class="form-input" required>
                                    </div>
                                </div>

                                <div class="pt-6">
                                    <button type="submit" class="w-full bg-cs-navy text-white font-bold py-5 rounded-lg text-sm hover:bg-cs-blue transition-all shadow-xl hover:shadow-glow hover:-translate-y-1 flex justify-center items-center gap-3">
                                        Angebot herunterladen
                                        <i class="fa-solid fa-download"></i>
                                    </button>
                                </div>
                            </form>
                        </div>

                        <!-- RIGHT: Summary Step 2 (Dark Navy) -->
                        <div class="w-full lg:w-5/12 bg-cs-navy p-8 md:p-10 lg:p-12 text-white flex flex-col justify-center relative overflow-hidden">
                            <!-- Background -->
                            <div class="absolute top-0 right-0 w-96 h-96 bg-cs-blue opacity-10 rounded-full blur-[80px] transform translate-x-1/2 -translate-y-1/2"></div>
                            <div class="absolute bottom-0 left-0 w-64 h-64 bg-blue-400 opacity-5 rounded-full blur-[60px]"></div>
                            
                            <div class="relative z-10 flex flex-col h-full">
                                <h3 class="font-heading font-bold text-2xl mb-8">Ihre Finanzierung</h3>
                                
                                <div class="space-y-4 text-sm flex-grow">
                                    <div class="flex justify-between border-b border-white/10 pb-3">
                                        <span class="text-white/60">Anschaffungspreis</span>
                                        <span class="font-bold" id="summary-price">0,00 €</span>
                                    </div>
                                    <div class="flex justify-between border-b border-white/10 pb-3">
                                        <span class="text-white/60">Laufzeit</span>
                                        <span class="font-bold"><span id="summary-duration">0</span> Monate</span>
                                    </div>
                                    <div class="flex justify-between border-b border-white/10 pb-3">
                                        <span class="text-white/60">Anzahlung</span>
                                        <span class="font-bold">0,00 €</span>
                                    </div>
                                    <div class="flex justify-between border-b border-white/10 pb-3">
                                        <span class="text-white/60">Restwert</span>
                                        <span class="font-bold" id="summary-residual-euro">0,00 €</span>
                                    </div>
                                    <div class="flex justify-between border-b border-white/10 pb-3">
                                        <span class="text-white/60">Leasingfaktor</span>
                                        <span class="font-bold" id="summary-leasing-factor">0,00 %</span>
                                    </div>
                                </div>

                                <div class="mt-12">
                                    <div class="text-white/60 font-heading text-xs mb-1 font-bold uppercase tracking-widest">Monatliche Rate</div>
                                    <div class="text-5xl font-extrabold tracking-tighter" id="summary-rate">0,00 €</div>
                                </div>

                                <div class="mt-10">
                                    <button onclick="goToStep(1)" class="text-white/60 hover:text-white text-sm font-bold flex items-center gap-2 transition-colors">
                                        <i class="fa-solid fa-arrow-left"></i> Zurück zur Berechnung
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>

                </div>
            </div>

            <!-- VIEW 2: BENEFITS (Cards) -->
            <div id="view-why" class="view-content absolute inset-x-0 top-0 w-full opacity-0 pointer-events-none transition-all duration-300">
                <div class="bg-white rounded-xl shadow-card p-8 md:p-16 lg:p-24 border border-gray-100 flex flex-col justify-center">
                    <div class="text-center mb-16">
                        <h2 class="text-3xl md:text-4xl font-bold text-cs-navy mb-4 font-heading">Warum Finanzierung?</h2>
                        <p class="text-slate-500 text-lg">Intelligentes Wachstum für Ihr Business.</p>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                        <!-- Benefit 1 -->
                        <div class="p-8 md:p-10 rounded-xl bg-gray-50 border border-transparent hover:border-cs-blue hover:bg-white hover:shadow-xl transition-all duration-300 group">
                            <div class="w-20 h-20 bg-white rounded-lg flex items-center justify-center text-cs-blue text-3xl shadow-sm mb-8 group-hover:bg-cs-blue group-hover:text-white transition-colors">
                                <i class="fa-solid fa-wallet"></i>
                            </div>
                            <h3 class="font-bold text-2xl mb-4 text-cs-navy">Liquidität</h3>
                            <p class="text-base text-slate-500 leading-relaxed">Keine hohe Einmalinvestition. Sie behalten Ihr Kapital für das operative Geschäft.</p>
                        </div>
                        
                        <!-- Benefit 2 -->
                        <div class="p-8 md:p-10 rounded-xl bg-gray-50 border border-transparent hover:border-cs-blue hover:bg-white hover:shadow-xl transition-all duration-300 group">
                            <div class="w-20 h-20 bg-white rounded-lg flex items-center justify-center text-cs-blue text-3xl shadow-sm mb-8 group-hover:bg-cs-blue group-hover:text-white transition-colors">
                                <i class="fa-solid fa-chart-line"></i>
                            </div>
                            <h3 class="font-bold text-2xl mb-4 text-cs-navy">Planbarkeit</h3>
                            <p class="text-base text-slate-500 leading-relaxed">Konstante, feste Raten über die gesamte Laufzeit erleichtern Ihre Budgetplanung.</p>
                        </div>

                        <!-- Benefit 3 -->
                        <div class="p-8 md:p-10 rounded-xl bg-gray-50 border border-transparent hover:border-cs-blue hover:bg-white hover:shadow-xl transition-all duration-300 group">
                            <div class="w-20 h-20 bg-white rounded-lg flex items-center justify-center text-cs-blue text-3xl shadow-sm mb-8 group-hover:bg-cs-blue group-hover:text-white transition-colors">
                                <i class="fa-solid fa-rocket"></i>
                            </div>
                            <h3 class="font-bold text-2xl mb-4 text-cs-navy">Innovation</h3>
                            <p class="text-base text-slate-500 leading-relaxed">Nutzen Sie immer die neueste Diagnostik-Technologie durch flexible Upgrades.</p>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <!-- FOOTER (Clean Minimalist) -->
    <footer class="bg-white border-t border-gray-100 py-12 mt-auto relative z-20">
        <div class="max-w-[1400px] mx-auto px-8 flex flex-col md:flex-row justify-between items-center gap-6">
            
            <!-- Left: Logo -->
            <a href="https://cardioscan.de" target="_blank" class="flex items-center gap-2 group">
                <img src="cardioscan_logo.png" alt="cardioscan Logo" class="h-10 md:h-14 object-contain group-hover:opacity-80 transition-opacity">
            </a>

            <!-- Right: Links & Flag -->
            <div class="flex items-center gap-6 md:gap-8 text-sm font-medium text-cs-navy">
                <a href="https://cardioscan.de/agb" target="_blank" class="hover:text-cs-blue transition-colors">AGB</a>
                <a href="https://cardioscan.de/datenschutz" target="_blank" class="hover:text-cs-blue transition-colors">Datenschutz</a>
                <a href="https://cardioscan.de/impressum" target="_blank" class="hover:text-cs-blue transition-colors">Impressum</a>
            </div>

        </div>
    </footer>

    <!-- LOGIC -->
    <script>
        // factors[residual][duration]
        const factors = {
            "15": { "48": 2.20, "54": 1.99, "60": null },
            "10": { "48": 2.29, "54": 2.07, "60": null },
            "5":  { "48": 2.39, "54": 2.15, "60": 1.97 }
        };

        // Initialize Height on Load
        window.addEventListener('load', () => {
            switchTab('calculator');
        });

        // Adjust height on resize
        window.addEventListener('resize', () => {
            const activeBtn = document.querySelector('.tab-btn.active');
            if(activeBtn) {
                const id = activeBtn.id.replace('tab-', '');
                adjustContainerHeight(id);
            }
        });

        function adjustContainerHeight(tabId) {
            const container = document.getElementById('content-container');
            const activeView = document.getElementById('view-' + tabId);
            if(activeView) {
                container.style.height = activeView.offsetHeight + 'px';
            }
        }

        function switchTab(tabId) {
            // Buttons style
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('active');
                if(btn.id === 'tab-' + tabId) btn.classList.add('active');
            });

            // Content Transition
            document.querySelectorAll('.view-content').forEach(view => {
                view.style.opacity = '0';
                view.style.pointerEvents = 'none';
                view.style.zIndex = '0';
            });

            const activeView = document.getElementById('view-' + tabId);
            if(activeView) {
                activeView.style.opacity = '1';
                activeView.style.pointerEvents = 'auto';
                activeView.style.zIndex = '10';
                
                // Adjust Parent Height
                setTimeout(() => adjustContainerHeight(tabId), 10);
            }
        }

        function formatCurrency(value) {
            return new Intl.NumberFormat('de-DE', { style: 'currency', currency: 'EUR' }).format(value);
        }

        function formatPriceInput(input) {
            // Aktuellen Wert holen und alle Punkte (Tausendertrenner) entfernen,
            // damit sie nicht fälschlicherweise in Kommas umgewandelt werden.
            let val = input.value.replace(/\./g, '');
            
            // Alles außer Ziffern und Komma entfernen
            val = val.replace(/[^\d,]/g, '');
            
            // Verhindern, dass mehr als ein Komma eingegeben wird
            let parts = val.split(',');
            if (parts.length > 2) {
                parts = [parts[0], parts.slice(1).join('')];
            }
            
            // Tausendertrennzeichen hinzufügen
            let integerPart = parts[0].replace(/\B(?=(\d{3})+(?!\d))/g, '.');
            
            // Wert wieder zusammensetzen (max. 2 Nachkommastellen)
            if (parts.length > 1) {
                input.value = integerPart + ',' + parts[1].substring(0, 2); 
            } else {
                input.value = integerPart;
            }
        }

        function updateResidualOptions() {
            const duration = document.getElementById('duration').value;
            const residualSelect = document.getElementById('residual');
            const options = residualSelect.options;

            for (let i = 0; i < options.length; i++) {
                const val = options[i].value;
                if (duration === "60") {
                    if (val === "10" || val === "15") {
                        options[i].hidden = true;
                        options[i].disabled = true;
                        options[i].style.display = 'none'; 
                    } else {
                        options[i].hidden = false;
                        options[i].disabled = false;
                        options[i].style.display = '';
                    }
                } else {
                     options[i].hidden = false;
                     options[i].disabled = false;
                     options[i].style.display = '';
                }
            }

            if (duration === "60" && (residualSelect.value === "10" || residualSelect.value === "15")) {
                residualSelect.value = "5";
            }
        }

        function calculate() {
            const priceInput = document.getElementById('price').value;
            const duration = document.getElementById('duration').value;
            const residual = document.getElementById('residual').value;
            
            const resultDisplay = document.getElementById('result-display');
            const errorMsg = document.getElementById('error-msg');
            const errorText = document.getElementById('error-text');
            const nextBtn = document.getElementById('btn-next');

            const price = parseFloat(priceInput.replace(/\./g, '').replace(',', '.'));

            if (!duration || !residual) {
                 return;
            }

            const factor = factors?.[residual]?.[duration] ?? null;

            if (factor === null) {
                resultDisplay.innerText = "—";
                errorText.innerText = `Diese Kombination (${duration} Monate / ${residual}%) ist aktuell nicht verfügbar.`;
                errorMsg.classList.remove('hidden');
                nextBtn.disabled = true;
            } else {
                errorMsg.classList.add('hidden');
                if (price && price > 0) {
                    const rate = price * (factor / 100);
                    resultDisplay.innerText = formatCurrency(rate);
                    nextBtn.disabled = false;
                } else {
                    resultDisplay.innerText = "0,00 €";
                    nextBtn.disabled = true;
                }
            }
        }

        // --- NEW LOGIC FOR 2-STEP PROCESS ---

        function goToStep(step) {
            const step1 = document.getElementById('calc-step-1');
            const step2 = document.getElementById('calc-step-2');

            if (step === 2) {
                // Populate Summary
                const priceStr = document.getElementById('price').value || "0";
                const durationVal = document.getElementById('duration').value;
                const residualVal = document.getElementById('residual').value;
                const rateVal = document.getElementById('result-display').innerText;

                // Calculations for Summary
                const price = parseFloat(priceStr.replace(/\./g, '').replace(',', '.')) || 0;
                const residualEuro = price * (parseFloat(residualVal) / 100);
                const factor = factors[residualVal]?.[durationVal];
                
                // Format Factor with comma (e.g. 2.29 -> 2,29)
                const formatFactor = (f) => f ? f.toString().replace('.', ',') + ' %' : '- %';

                // Format Price to always have 2 decimals
                const formattedPrice = new Intl.NumberFormat('de-DE', { minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(price);

                // Set HTML text values
                document.getElementById('summary-price').innerText = formattedPrice + ' €';
                document.getElementById('summary-duration').innerText = durationVal;
                document.getElementById('summary-residual-euro').innerText = formatCurrency(residualEuro);
                document.getElementById('summary-leasing-factor').innerText = formatFactor(factor);
                document.getElementById('summary-rate').innerText = rateVal;

                // Show Step 2
                step1.classList.remove('active-step', 'flex');
                step1.classList.add('hidden-step');
                
                step2.classList.remove('hidden-step');
                step2.classList.add('active-step', 'flex');
            } else {
                // Show Step 1
                step2.classList.remove('active-step', 'flex');
                step2.classList.add('hidden-step');

                step1.classList.remove('hidden-step');
                step1.classList.add('active-step', 'flex');
            }
            
            // Adjust container height for the new step after a tiny delay
            setTimeout(() => adjustContainerHeight('calculator'), 50);
        }

        function downloadOfferPDF() {
            // Get Form Data
            const art = document.getElementById('form-finanzierungsart').value;
            const anrede = document.getElementById('form-anrede').value;
            const vorname = document.getElementById('form-vorname').value;
            const nachname = document.getElementById('form-nachname').value;
            const firma = document.getElementById('form-firma').value;
            const strasse = document.getElementById('form-strasse').value;
            const plz = document.getElementById('form-plz').value;
            const ort = document.getElementById('form-ort').value;

            // Generate Salutation
            let salutation = "";
            if (anrede === "Frau") {
                salutation = `Sehr geehrte Frau ${nachname},`;
            } else if (anrede === "Herr") {
                salutation = `Sehr geehrter Herr ${nachname},`;
            } else {
                salutation = `Guten Tag ${vorname} ${nachname},`;
            }

            // Generate Date & City (ohne "den")
            const date = new Date();
            const datum = ('0' + date.getDate()).slice(-2) + '.' + ('0' + (date.getMonth() + 1)).slice(-2) + '.' + date.getFullYear();
            const stadt = "Hamburg";

            // Get Calculator Values (.textContent verhindert Lesefehler von DOM Styles)
            const preisVal = document.getElementById('summary-price').textContent.replace(/[^\d.,]/g, '').trim();
            const laufzeitVal = document.getElementById('summary-duration').textContent.replace(/[^\d.,]/g, '').trim();
            const restwertEuroVal = document.getElementById('summary-residual-euro').textContent.replace(/[^\d.,]/g, '').trim();
            const leasingfaktorVal = document.getElementById('summary-leasing-factor').textContent.replace(/[^\d.,]/g, '').trim();
            const rateVal = document.getElementById('summary-rate').textContent.replace(/[^\d.,]/g, '').trim();

            // Specific Note based on Template logic (Mietkauf bold)
            const extraHinweis = (art === "Leasing")
                ? "Die oben genannten Preise verstehen sich netto, zuzüglich der gesetzlichen Mehrwertsteuer."
                : "<strong>Hinweis: Die gesetzl. Mehrwertsteuer fällt vorab auf die Summe aller Zahlungen an.</strong>";

            // Wrapper für garantierte Clipping-Vermeidung
            // Position: fixed ignoriert jegliches Scrollen des Browsers!
            const wrapper = document.createElement('div');
            wrapper.style.position = 'fixed';
            wrapper.style.top = '0';
            wrapper.style.left = '0';
            wrapper.style.width = '170mm'; // Exakte Breite innerhalb der A4-Ränder (210mm - 40mm)
            wrapper.style.zIndex = '-9999';
            wrapper.style.backgroundColor = '#fff';

            const htmlContent = `
                <div style="font-family: Arial, sans-serif; font-size: 11pt; color: #000; line-height: 1.5; width: 100%; min-height: 257mm; position: relative; box-sizing: border-box; background: #fff; margin: 0; padding: 0;">
                    
                    <!-- Header mit Logo (rechtsbündig) -->
                    <table style="width: 100%; border: none; margin-bottom: 12mm; border-collapse: collapse;">
                        <tr>
                            <td style="text-align: right; padding: 0;">
                                <img src="cardioscan_logo.png" style="height: 45px; max-width: 250px; object-fit: contain; display: inline-block;" alt="cardioscan Logo">
                            </td>
                        </tr>
                    </table>
                    
                    <!-- Address & Date -->
                    <table style="width: 100%; border: none; margin-bottom: 15mm; border-collapse: collapse; font-size: 11pt;">
                        <tr>
                            <td style="vertical-align: top; text-align: left; padding: 0; width: 60%; line-height: 1.5;">
                                ${firma}<br>
                                ${anrede} ${vorname} ${nachname}<br>
                                ${strasse}<br>
                                ${plz} ${ort}
                            </td>
                            <td style="vertical-align: top; text-align: right; padding: 0; width: 40%; line-height: 1.5;">
                                ${stadt}, ${datum}
                            </td>
                        </tr>
                    </table>
                    
                    <!-- Subject -->
                    <div style="font-weight: bold; margin-bottom: 10mm; font-size: 11pt;">
                        Finanzierungsangebot: ${art}
                    </div>
                    
                    <!-- Salutation -->
                    <p style="margin-top: 0; margin-bottom: 5mm;">${salutation}</p>
                    <p style="margin-top: 0; margin-bottom: 12mm;">vielen Dank für das entgegengebrachte Vertrauen! Wie folgt bieten wir Ihnen unverbindlich an:</p>
                    
                    <!-- Values (Zentriert, kompakt & ohne Überschneidungen) -->
                    <table style="margin: 0 auto; width: 85mm; border-collapse: collapse; font-size: 11pt;">
                        <tr>
                            <td style="padding: 1.5mm 0; text-align: left;">Anschaffungspreis:</td>
                            <td style="padding: 1.5mm 0; text-align: right; white-space: nowrap;"><strong>${preisVal}</strong></td>
                            <td style="padding: 1.5mm 0 1.5mm 4mm; width: 12mm; text-align: left;">€</td>
                        </tr>
                        <tr>
                            <td style="padding: 1.5mm 0; text-align: left;">Laufzeit:</td>
                            <td style="padding: 1.5mm 0; text-align: right; white-space: nowrap;"><strong>${laufzeitVal}</strong></td>
                            <td style="padding: 1.5mm 0 1.5mm 4mm; width: 12mm; text-align: left;">Monate</td>
                        </tr>
                        <tr>
                            <td style="padding: 1.5mm 0; text-align: left;">Mietsonderzahlung:</td>
                            <td style="padding: 1.5mm 0; text-align: right; white-space: nowrap;"><strong>0,00</strong></td>
                            <td style="padding: 1.5mm 0 1.5mm 4mm; width: 12mm; text-align: left;">€</td>
                        </tr>
                        <tr>
                            <td style="padding: 1.5mm 0; text-align: left;">Monatliche Rate:</td>
                            <td style="padding: 1.5mm 0; text-align: right; white-space: nowrap;"><strong>${rateVal}</strong></td>
                            <td style="padding: 1.5mm 0 1.5mm 4mm; width: 12mm; text-align: left;">€</td>
                        </tr>
                        <tr>
                            <td style="padding: 1.5mm 0; text-align: left;">Rate in %:</td>
                            <td style="padding: 1.5mm 0; text-align: right; white-space: nowrap;"><strong>${leasingfaktorVal}</strong></td>
                            <td style="padding: 1.5mm 0 1.5mm 4mm; width: 12mm; text-align: left;">%</td>
                        </tr>
                        <tr>
                            <td style="padding: 1.5mm 0; text-align: left;">kalk. Restwert:</td>
                            <td style="padding: 1.5mm 0; text-align: right; white-space: nowrap;"><strong>${restwertEuroVal}</strong></td>
                            <td style="padding: 1.5mm 0 1.5mm 4mm; width: 12mm; text-align: left;">€</td>
                        </tr>
                    </table>

                    <!-- Note -->
                    <p style="margin-top: 15mm; margin-bottom: 0;">${extraHinweis}</p>
                    <br>
                    <p style="margin-top: 0; margin-bottom: 12mm;">Wir freuen uns, für Sie tätig werden zu können und sichern Ihnen bereits jetzt eine faire, schnelle und unbürokratische Abwicklung zu.</p>
                    
                    <p style="margin-top: 0; margin-bottom: 5mm;">Mit freundlichen Grüßen,</p>
                    <p style="margin-top: 0;"><strong>cardioscan GmbH</strong></p>

                    <!-- Footer (Passgenau in exakt 2 Zeilen) -->
                    <div style="position: absolute; bottom: 0; left: 0; width: 100%; border-top: 1px solid #999; padding-top: 3mm;">
                        <table style="width: 100%; font-size: 6.5pt; color: #333; line-height: 1.3; border-collapse: collapse; border: none; font-family: Arial, sans-serif;">
                            <tr>
                                <td style="vertical-align: top; width: 15%; padding: 0;">
                                    cardioscan GmbH<br>
                                    Theodorstr. 41r, 22761 HH
                                </td>
                                <td style="vertical-align: top; width: 28%; padding: 0;">
                                    Geschäftsführer Dr. Marc Weitl<br>
                                    Amtsgericht HH HRB 117288, Ust-IdNr. DE268167789
                                </td>
                                <td style="vertical-align: top; width: 20%; padding: 0;">
                                    Fon (+49) 40-303 723 30<br>
                                    info@cardioscan.de, www.cardioscan.de
                                </td>
                                <td style="vertical-align: top; width: 37%; padding: 0;">
                                    Sydbank IBAN DE55 2151 0600 1000 6859 59 SYBKDE22<br>
                                    Commerzbank IBAN DE33 2004 0000 0630 1527 00 COBADEFFXXX
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
            `;

            wrapper.innerHTML = htmlContent;
            document.body.appendChild(wrapper);

            // Setup PDF Download Name
            const firmaClean = firma.replace(/[^a-zA-Z0-9]/g, '_');
            const filename = `cardioscan_${art}_${firmaClean}.pdf`;

            // HTML2PDF Options 
            const opt = {
                margin:       20, 
                filename:     filename,
                image:        { type: 'jpeg', quality: 1 },
                // windowWidth: 1024 kombiniert mit wrapper fixed pos verhindert clipping endgültig!
                html2canvas:  { scale: 2, useCORS: true, scrollY: 0, scrollX: 0, windowWidth: 1024 },
                jsPDF:        { unit: 'mm', format: 'a4', orientation: 'portrait' }
            };

            // Generate & Download direkt aus dem temporären wrapper.
            html2pdf().set(opt).from(wrapper).save().then(() => {
                document.body.removeChild(wrapper); // Sauberer Code: Löscht das versteckte Element wieder
            });
        }
    </script>
</body>
</html>
